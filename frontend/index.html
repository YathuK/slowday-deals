<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="format-detection" content="telephone=no, address=no, email=no">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SlowDay Deals - Service Marketplace</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.min.js"></script>
    <script src="api.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            overscroll-behavior: none;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overscroll-behavior: none;
            min-height: 100vh;
            min-height: 100svh;
            touch-action: pan-y;
            -webkit-text-size-adjust: 100%;
        }

        .app-container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            min-height: 100svh;
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.3);
            overflow-x: hidden;
            overflow-y: auto;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0 16px;
            position: fixed;
            top: 0;
            top: env(safe-area-inset-top);
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 500px;
            z-index: 100;
            box-shadow: 0 2px 12px rgba(0,0,0,0.15);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 58px;
            flex-shrink: 0;
        }

        .header h1 { display: none; }
        .header p  { display: none; }

        .header-logo {
            display: flex;
            align-items: center;
            gap: 0;
            flex-shrink: 0;
        }

        .mode-toggle {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }

        .mode-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            color: #666;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* Provider View Styles */
        .provider-form {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .price-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .photo-upload {
            border: 2px dashed #e0e0e0;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .photo-upload:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .photo-upload input {
            display: none;
        }

        .photo-preview {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .photo-preview img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 10px;
            cursor: pointer;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        /* Customer View Styles */
        .swipe-container {
            position: relative;
            height: calc(100svh - 195px);
            height: calc(100vh - 195px);
            min-height: 360px;
            padding: 12px 16px 16px;
            overflow: hidden;
        }

        .card-stack {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .service-card {
            position: absolute;
            width: 100%;
            height: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            cursor: grab;
            touch-action: none;
            transition: transform 0.3s, box-shadow 0.3s;
            user-select: none;
            -webkit-user-select: none;
        }

        .service-card:active {
            cursor: grabbing;
        }

        .service-card.swiping-right {
            border: 3px solid #4ade80;
        }

        .service-card.swiping-left {
            border: 3px solid #f87171;
        }

        .card-image {
            width: 100%;
            height: 55%;
            object-fit: cover;
            touch-action: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            flex-shrink: 0;
        }

        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-content {
            padding: 10px 14px 4px;
            height: 45%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            touch-action: pan-y;
            overscroll-behavior-y: contain;
        }

        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .service-title {
            font-size: 22px;
            font-weight: 700;
            color: #333;
        }

        .service-type {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }

        .provider-name {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .service-description {
            color: #555;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .price-display {
            display: flex;
            gap: 10px;
            margin-top: 12px;
            align-items: stretch;
        }

        .price-box {
            flex: 1;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
        }

        .price-label {
            font-size: 11px;
            color: #666;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .price-value {
            font-size: 22px;
            font-weight: 700;
            color: #667eea;
        }

        /* Deal price badge â€” animated, eye-catching */
        .deal-price-badge {
            flex: 1;
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 10px;
            border-radius: 12px;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(102,126,234,0.4);
            animation: dealPulse 2s ease-in-out infinite;
        }
        @keyframes dealPulse {
            0%,100% { box-shadow: 0 4px 15px rgba(102,126,234,0.4); transform: scale(1); }
            50%      { box-shadow: 0 6px 25px rgba(102,126,234,0.7); transform: scale(1.02); }
        }
        .deal-price-badge::before {
            content:'';
            position:absolute;
            top:-50%;left:-60%;
            width:40%;height:200%;
            background:rgba(255,255,255,0.15);
            transform:skewX(-15deg);
            animation: shimmer 3s ease-in-out infinite;
        }
        @keyframes shimmer {
            0%   { left:-60%; }
            100% { left:120%; }
        }
        .deal-price-badge .price-label { color: rgba(255,255,255,0.8); }
        .deal-price-badge .deal-actual  { font-size:22px; font-weight:800; color:white; line-height:1; }
        .deal-price-badge .deal-normal  { font-size:12px; color:rgba(255,255,255,0.7); text-decoration:line-through; margin-top:2px; }
        .deal-price-badge .deal-pct     { position:absolute;top:6px;right:6px;background:#fbbf24;color:#92400e;font-size:10px;font-weight:800;padding:2px 6px;border-radius:20px;line-height:1.4; }

        /* Slots remaining */
        .slots-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: #fef3c7;
            color: #92400e;
            font-size: 11px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 20px;
            margin-top: 8px;
        }
        .slots-badge.low  { background:#fee2e2; color:#991b1b; animation: slotBlink 1s ease-in-out infinite; }
        .slots-badge.gone { background:#e5e7eb; color:#6b7280; }
        @keyframes slotBlink { 0%,100%{opacity:1} 50%{opacity:0.6} }

        /* Grayed out deal card */
        .deal-ended-overlay {
            position:absolute;
            inset:0;
            background:rgba(255,255,255,0.75);
            backdrop-filter:blur(2px);
            display:flex;
            flex-direction:column;
            align-items:center;
            justify-content:center;
            z-index:5;
            border-radius:inherit;
        }
        .deal-ended-overlay .ended-icon { font-size:48px; margin-bottom:8px; filter:grayscale(1); }
        .deal-ended-overlay .ended-text { font-size:18px; font-weight:800; color:#6b7280; }
        .deal-ended-overlay .ended-sub  { font-size:13px; color:#9ca3af; margin-top:4px; }
        .service-card.deal-ended { filter: grayscale(0.5); }

        .swipe-indicator {
            position: absolute;
            top: 50%;
            font-size: 80px;
            font-weight: 900;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
            z-index: 10;
        }

        .like-indicator {
            left: 30px;
            color: #4ade80;
            transform: rotate(-20deg);
        }

        .nope-indicator {
            right: 30px;
            color: #f87171;
            transform: rotate(20deg);
        }

        .service-card.swiping-right .like-indicator {
            opacity: 1;
        }

        .service-card.swiping-left .nope-indicator {
            opacity: 1;
        }

        .card-action-row {
            display: flex;
            justify-content: center;
            gap: 24px;
            padding: 8px 0 2px;
            border-top: 1px solid #f0f0f0;
            margin-top: 4px;
        }

        .card-btn {
            width: 54px;
            height: 54px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 3px 12px rgba(0,0,0,0.12);
        }

        .card-btn:hover { transform: scale(1.1); }
        .card-btn:active { transform: scale(0.95); }

        .card-btn-nope  { background: #fff0f0; color: #f87171; }
        .card-btn-info  { background: #e0f2fe; color: #0284c7; }
        .card-btn-like  { background: #f0fdf4; color: #4ade80; }

        .no-cards {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 40px 20px;
            text-align: center;
        }

        .empty-emoji {
            font-size: 72px;
            animation: bounce 1.2s infinite;
            margin-bottom: 16px;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-16px); }
        }

        .empty-state h3 {
            font-size: 22px;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .empty-state p {
            color: #888;
            font-size: 14px;
            line-height: 1.6;
            max-width: 240px;
        }

        .empty-dots {
            display: flex;
            gap: 8px;
            margin-top: 24px;
            justify-content: center;
        }

        .empty-dots span {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            animation: pulse-dot 1.4s infinite ease-in-out;
        }

        .empty-dots span:nth-child(2) { animation-delay: 0.2s; }
        .empty-dots span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes pulse-dot {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
            40% { transform: scale(1); opacity: 1; }
        }

        .no-cards svg {
            margin-bottom: 20px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }

        .modal-header h2 {
            font-size: 20px;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            color: #666;
        }

        .modal-body {
            padding: 20px;
        }

        .detail-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .gallery {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .gallery img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 10px;
            cursor: pointer;
        }

        .detail-section {
            margin-bottom: 20px;
        }

        .detail-section h3 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #333;
        }

        .book-now-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
        }

        /* Booking Form */
        .booking-form .form-group {
            margin-bottom: 15px;
        }

        .success-message {
            background: #dcfce7;
            color: #166534;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        /* Saved Services */
        .saved-list {
            padding: 20px;
        }

        .saved-card {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            gap: 15px;
        }

        .saved-card img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 10px;
        }

        .saved-card-content {
            flex: 1;
        }

        .saved-card h3 {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .saved-card p {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        .saved-card-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .saved-card-actions button {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        .book-btn-small {
            background: #667eea;
            color: white;
        }

        .remove-btn {
            background: #fee;
            color: #f87171;
        }

        .tab-nav {
            display: flex;
            border-bottom: 1px solid #e0e0e0;
            padding: 0 20px;
            background: white;
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .auth-form {
            max-width: 400px;
            margin: 0 auto;
        }

        .user-menu {
            position: relative;
            right: auto;
            top: auto;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }

        .user-name {
            color: white;
            font-size: 14px;
            font-weight: 600;
        }

        .user-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: white;
            color: #667eea;
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid rgba(255,255,255,0.5);
            transition: transform 0.2s;
            user-select: none;
        }

        .user-avatar:hover { transform: scale(1.05); }

        .user-dropdown {
            position: fixed;
            top: 66px;
            right: calc(50% - 240px);
            background: white;
            border-radius: 16px;
            box-shadow: 0 12px 48px rgba(0,0,0,0.18);
            padding: 16px;
            min-width: 240px;
            z-index: 10000;
        }

        @media (max-width: 520px) {
            .user-dropdown { right: 8px; }
        }

        .user-dropdown-name {
            font-weight: 700;
            font-size: 15px;
            color: #333;
        }

        .user-dropdown-email {
            font-size: 12px;
            color: #888;
            margin-top: 2px;
            margin-bottom: 8px;
        }

        .dropdown-btn {
            width: 100%;
            background: #f5f5f5;
            border: none;
            padding: 10px 14px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            text-align: left;
            margin-top: 6px;
            transition: background 0.2s;
        }

        .dropdown-btn:hover { background: #ede9fe; color: #667eea; }
        .logout-red:hover { background: #fee2e2 !important; color: #e53e3e !important; }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .circle-login-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .circle-login-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
            transform: scale(1.05);
        }

        .login-prompt {
            padding: 40px 20px;
            text-align: center;
            color: #666;
        }

        .login-prompt svg {
            margin-bottom: 20px;
        }

        .login-prompt button {
            margin-top: 20px;
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        /* ---- Provider Tabs ---- */
        .provider-tabs {
            display: flex;
            border-bottom: 2px solid #f0f0f0;
            background: white;
            position: fixed;
            top: 58px;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 500px;
            z-index: 90;
            box-sizing: border-box;
        }
        #providerView .tab-content,
        #ptabBookingsContent,
        #ptabCalendarContent,
        #ptabAnalyticsContent,
        #ptabProfileContent {
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 80px;
        }

        #customerView .tab-content {
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior-y: contain;
            padding-top: 58px;
            padding-bottom: 80px;
        }
        #savedTab {
            padding-top: 0;
        }
        #bookingsListWrap {
            padding-top: 16px;
        }
        #savedListWrap, #myBookingsWrap {
            padding-top: 33px;
        }
        #ptabProfileContent,
        #ptabBookingsContent,
        #ptabCalendarContent,
        #ptabAnalyticsContent {
            padding-top: 103px;
            padding-bottom: 80px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        #customerView #discoverTab {
            overflow: hidden;
            height: calc(100svh - 200px);
            height: calc(100vh - 200px);
            margin-top: 130px;
            padding-top: 0 !important;
            padding-bottom: 0 !important;
            touch-action: none;
            overscroll-behavior: none;
        }

        .ptab-btn {
            flex: 1;
            padding: 14px 4px;
            border: none;
            background: transparent;
            font-size: 13px;
            font-weight: 600;
            color: #aaa;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            white-space: nowrap;
            position: relative;
        }
        .ptab-btn.active { color: #667eea; border-bottom-color: #667eea; }
        .badge {
            background: #e53e3e;
            color: white;
            font-size: 10px;
            font-weight: 700;
            border-radius: 10px;
            padding: 1px 6px;
            margin-left: 4px;
            vertical-align: middle;
        }

        /* ---- Filter buttons ---- */
        .filter-btn {
            padding: 7px 14px;
            border: 1.5px solid #e0e0e0;
            background: white;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: #888;
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
        }
        .filter-btn.active { background: #667eea; color: white; border-color: #667eea; }

        /* ---- Booking cards ---- */
        .booking-card {
            background: white;
            border-radius: 14px;
            border: 1.5px solid #f0f0f0;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .booking-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        .booking-card-title { font-size: 16px; font-weight: 700; color: #333; }
        .booking-card-sub { font-size: 13px; color: #888; margin-top: 2px; }
        .status-pill {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }
        .status-pending   { background: #fef3c7; color: #d97706; }
        .status-confirmed { background: #d1fae5; color: #059669; }
        .status-rejected  { background: #fee2e2; color: #dc2626; }
        .status-cancelled { background: #f3f4f6; color: #6b7280; }
        .status-rescheduled { background: #dbeafe; color: #2563eb; }
        .status-completed { background: #ede9fe; color: #7c3aed; }
        .booking-meta { font-size: 13px; color: #555; margin-bottom: 4px; } .booking-meta a { text-decoration: none !important; color: inherit !important; } .no-link { -webkit-user-select: text; text-decoration: none !important; pointer-events: none; }
        .booking-meta span { color: #888; }
        .booking-actions { display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap; }
        .action-btn {
            flex: 1;
            min-width: 80px;
            padding: 9px 6px;
            border: none;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }
        .btn-confirm   { background: #d1fae5; color: #059669; }
        .btn-reject    { background: #fee2e2; color: #dc2626; }
        .btn-reschedule{ background: #dbeafe; color: #2563eb; }
        .btn-cancel    { background: #f3f4f6; color: #6b7280; }

        /* ---- Analytics ---- */
        .analytics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            border-radius: 14px;
            padding: 16px;
            border: 1.5px solid #f0f0f0;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .stat-card .stat-label { font-size: 11px; color: #888; font-weight: 600; text-transform: uppercase; margin-bottom: 6px; }
        .stat-card .stat-value { font-size: 26px; font-weight: 800; color: #333; }
        .stat-card .stat-earn  { font-size: 13px; color: #667eea; font-weight: 600; margin-top: 2px; }
        .stat-card.highlight   { background: linear-gradient(135deg, #667eea, #764ba2); border-color: transparent; }
        .stat-card.highlight .stat-label { color: rgba(255,255,255,0.75); }
        .stat-card.highlight .stat-value { color: white; }
        .stat-card.highlight .stat-earn  { color: rgba(255,255,255,0.85); }
        .chart-bar-wrap { margin-bottom: 20px; }
        .chart-bar-wrap h3 { font-size: 14px; font-weight: 700; color: #333; margin-bottom: 12px; }
        .bar-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
        .bar-label { font-size: 11px; color: #888; width: 72px; text-align: right; flex-shrink: 0; }
        .bar-track { flex: 1; background: #f0f0f0; border-radius: 6px; height: 20px; overflow: hidden; }
        .bar-fill  { height: 100%; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 6px; transition: width 0.6s ease; min-width: 2px; }
        .bar-val   { font-size: 12px; font-weight: 600; color: #555; width: 36px; }

        /* ---- Customer bookings ---- */
        .my-bookings-section { padding: 16px; }
        .my-bookings-section h3 { font-size: 16px; font-weight: 700; color: #333; margin-bottom: 12px; }

        /* ---- Saved sub-tabs ---- */
        .saved-subtabs { display: flex; border-bottom: 1.5px solid #f0f0f0; margin-bottom: 0; position: fixed; top: 58px; left: 50%; transform: translateX(-50%); width: 100%; max-width: 500px; background: white; z-index: 90; box-sizing: border-box; }
        .saved-stab { flex: 1; padding: 12px; border: none; background: transparent; font-size: 13px; font-weight: 600; color: #aaa; cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -1.5px; }
        .saved-stab.active { color: #667eea; border-bottom-color: #667eea; }

        .location-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            cursor: pointer;
            padding: 4px 0;
            border-radius: 8px;
            transition: opacity 0.15s;
        }
        .location-header:active { opacity: 0.7; }
        #mapChevron { transition: transform 0.25s ease; flex-shrink: 0; }

        .dir-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 11px 8px;
            border-radius: 10px;
            color: white;
            font-size: 13px;
            font-weight: 600;
            text-decoration: none;
            transition: opacity 0.2s;
        }
        .dir-btn:active { opacity: 0.8; }
        .custom-dt-picker {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .dt-date-input {
            width: 100%;
            max-width: 100%;
            padding: 12px 14px;
            border: 1.5px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            color: #333;
            background: white;
            box-sizing: border-box;
            margin-bottom: 8px;
            display: block;
            -webkit-appearance: none;
            appearance: none;
            min-height: 46px;
        }
        .dt-date-input:focus { border-color: #667eea; outline: none; }
        .dt-time-row {
            display: flex;
            gap: 8px;
            margin-top: 0;
        }
        .dt-select {
            flex: 1;
            padding: 12px 10px;
            border: 1.5px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            color: #333;
            background: white;
            cursor: pointer;
            text-align: center;
            appearance: none;
            -webkit-appearance: none;
        }
        .dt-select:focus { border-color: #667eea; outline: none; }

        @media (max-width: 600px) {
            .swipe-container { height: calc(100vh - 225px); min-height: 320px; }
        }

        .search-bar-wrap {
            padding: 12px 16px 8px;
            background: #f8f9ff;
            border-bottom: 1px solid #eee;
            position: fixed;
            top: 58px;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 500px;
            z-index: 200;
            box-sizing: border-box;
        }

        .search-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            border: 1.5px solid #e0e0e0;
            border-radius: 12px;
            padding: 10px 14px 10px 12px;
            overflow: visible;
        }

        .search-bar svg {
            display: block;
            flex-shrink: 0;
            width: 20px;
            height: 20px;
            overflow: visible;
        }

        .search-bar input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 14px;
            color: #333;
            background: transparent;
            min-width: 0;
        }

        .search-bar select {
            border: none;
            outline: none;
            font-size: 13px;
            color: #667eea;
            font-weight: 600;
            background: transparent;
            cursor: pointer;
            flex-shrink: 0;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 500px;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            z-index: 200;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.08);
            padding-bottom: env(safe-area-inset-bottom, 8px);
            height: calc(65px + env(safe-area-inset-bottom, 0px));
            overflow: hidden;
        }

        .nav-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 12px 6px;
            border: none;
            background: transparent;
            cursor: pointer;
            color: #bbb;
            font-weight: 600;
            gap: 3px;
            transition: color 0.2s;
            overflow: visible;
            min-width: 60px;
        }

        .nav-btn svg {
            display: block;
            width: 24px;
            height: 24px;
            flex-shrink: 0;
            overflow: visible;
        }

        .nav-btn.active { color: #667eea; }
        .nav-btn span { font-size: 10px; white-space: nowrap; }

        .app-container { padding-bottom: 65px; }

        #myProfileCard {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .profile-card-img {
            width: 100%;
            height: 220px;
            object-fit: cover;
        }

        .profile-card-img-placeholder {
            width: 100%;
            height: 220px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 72px;
        }

        .profile-card-body {
            padding: 20px;
        }

        .profile-card-body h2 { font-size: 20px; color: #333; margin-bottom: 4px; }
        .profile-card-body .type-badge {
            display: inline-block;
            background: #ede9fe;
            color: #667eea;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .profile-card-body p { color: #555; font-size: 14px; line-height: 1.6; margin-bottom: 12px; }
        .profile-price-row { display: flex; gap: 12px; }
        .profile-price-box { flex: 1; background: #f8f9ff; border-radius: 10px; padding: 10px; text-align: center; }
        .profile-price-box .label { font-size: 11px; color: #888; font-weight: 600; text-transform: uppercase; }
        .profile-price-box .value { font-size: 20px; color: #667eea; font-weight: 700; }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCzFOIKj0VhPwBjEV2IQljeZ3Yw6l99jWI&libraries=places&callback=initPlaces" async defer></script>
</head>
<body>
    <div class="app-container">
        <div class="header" id="mainHeader">
            <!-- Left: Logo directly on gradient -->
            <div class="header-logo" style="display:flex;align-items:center;gap:10px;cursor:pointer;" onclick="showTab('discover')">
                <!-- Icon: calendar + bolt on gradient -->
                <img src="data:image/png;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDAAUDBAQEAwUEBAQFBQUGBwwIBwcHBw8LCwkMEQ8SEhEPERETFhwXExQaFRERGCEYGh0dHx8fExciJCIeJBweHx7/2wBDAQUFBQcGBw4ICA4eFBEUHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh7/wAARCAEAAQADASIAAhEBAxEB/8QAHAAAAQUBAQEAAAAAAAAAAAAAAgABAwcIBAUG/8QAUxAAAQMDAQQEBQ0NBgQHAAAAAQACAwQFEQYHEiExCBNBURQiI3GTMjdSVGFydIGxtMLR0hUWJDM2QlVXdZGSlaEXRWJlhcEmQ2SCU3aDw+Hw8f/EABsBAQEAAgMBAAAAAAAAAAAAAAABAgQDBgcF/8QANREAAgEDAAYIBgIBBQAAAAAAAAECAwQRBRITITFxBhYzQVGRobEVIjRSYYFC0TIkweHw8f/aAAwDAQACEQMRAD8AxkkkkgEkkkgEkkvsNCbNtW6xa2qtdskjtgmbHNcagiOniBOC7edje3cHIbkj4wrGLk8JZYPj0+D3LRlk2D6UoJ2vvepKy9GObPVW+AwRSx4HAyP8ZpzniAeGFYA0xoenroqu16C0/RyReo6yJ04zjGS17i0/GF9Sjoa6q73HHMyUWzGeFM2jqnAObTTEHiCIzx/otnPttokdl2ntOD3tmpx9Fe/HqO/xRMiiu9THExoYxjDuta0DAAA5ADhhbi6O1u+a9S6jMJ+BVntWf0Z+pLwKr9qz+jP1LdbtSaiP991vpCm++LUP6brvSlXq5V+9epdmzCvgVX7Vn9GfqS8Cq/as/oz9S3WNRah/Tdd6UohqHUH6brfSlXq5V+9eo2bMJeBVftWf0Z+pLwKr9qz+jP1Ld41DqA/31W+kKMahv/6arfSlOrlX716jZswb4FV+1Z/Rn6kvAqv2rP6M/Ut6DUN//TNb6UpjqDUB/vqt9KU6uVfvXqNmzBngVX7Vn9GfqS8CrPas/oz9S3n98GoP03W+kKf74dQ/put9IU6uVfvXqXZMwX4FWe1Z/Rn6kvAqz2rP6M/Ut5/fBqD9N1vpCn+7+of03W+kKdXKv3r1GyZgp1JVNaXOppg0DJJjOAocLfFRer3U00tNU3SeogmYY5YpvHY9pGC1zTwII4EFeNBabPDxbpzTTvf2anP0Vi+jtbumvUbJmIMHuTLatZpXRFfVTVF10Bp+qkmZuOfBEaYtG7ugtEZDQQO3HPnlVrqLYDYKtssuntR1Func+R8dNc4d6INwSyMSs45zgbzgBjitOvoW7pb9XK/Bi6ckZ0SX1et9nesNGxMqb9ZpoaKV5ZDWRuEsEhBIGHtJAzgkA4JHHC+UXy5RcXhmAkkklAJJJJAJJJJAJHDFJNMyGGN0kj3BrGNGS4ngAB2lC0FxAAJJ5ALT+yDQTdBUMV0uELHapq4945cXNoIHxtIY6NzRifJOTx3cDB5rZtLSpdVFTgVLJ5Gy/Y9RWCT7pa9oGVl2Y9rqe0mVr4Yhu5JqcZ3jkjyYPAtO9kcFas881SIxPJvMiaGRRNaGxxNAwA1owAMAD4lyM5kkkknJJPEnvKkBXeLOwo2kcQW/x7zkSSJG4RhRgosrdKGllDlLKoHToU4KGSCCIIAUQVKSBOCgCIIAwUSjBRAoUIIhjuQZRZQDjCfATBOhR0/DuTBPlALAPYkWgjBGR7qcJKAZ8UMlHLRVFNT1VFMWmakqYxLBLggjeY7IOCAqZ2xbFqavc697PqAwTnrJa20daN0DBdvU2eY4EdXkuzjGRwF0ZSBIILSQQcgg4IPePdWje6Oo3cfmWH4mMoqRg97XMcWuBDgcEHsTLVm2nZvSazs9RdbRS0tPqakj60vHkxXQRtO8wgYb1oHEO5uDQFlM8F0i7tKlrU2c/wD012mmJJJJapBJJJxxKAuHo0aZgqLtVazuMMjqezPYKBpaDHPWE5a12QQ5rG+MQOPqO9XaHSPe+SV7pJZCXPe45LieZK8rRVmGnNn2nrA6ExVDaY11Y10IY/r5uOHY5lrNwAnjjC9ULvOh7VULZSa3y3v/AGM1uDCMFA0ogvqlySNKIFRAogVSkgSQgp8+6hQkkOUsqgIFGCo8pwULklDkQKiBTgoUmBSygDk+QhQwUQco8pwUBKCiyogUYKhQ8p8ocpZQuQspwUGUt5AHlJBvIgVQJrnskbJE8skYQ5jgcFpHIrOvSh0hR2jUVJqi0wCCjvbXOqIIoC2KmqWYD2tI4eOPKY7MnhjC0Uvntq1tde9kuprS2OomkjhZcaeOHGTJC7xic/miMvJ5epXx9N2yrW7muMd/9mFRZRjJJOeaZdHNcS9rQtrrr1rG0Wu20/hFXU1kTI48gAneHMngB3k8AvFVrdFCfwbbZbJs43KOuPP/AKWVZQjrSS8QaBvdZ4ffLhWjG7NUvc3AwN3PBcoK56Y+Rb7uflUwK9MjFRWqu4zySAowVECiBVBICiBUYKIFCkgKWUGUsqlDBRZUeUgULkkCcFAClntQEgKIFTWq33C6ydVbKOaqf/gad0ecr7WzbKNTVrGvrJIKBh7PVkfIuCtdUKHaSSJrI+Fyl1jQeLmj41cFBsVtzSDXXiqnPaGDcC96j2VaTp8b1NLMR/4jsr51TTtnHg2/0TXKCEsfs2/vRCRnYSfMCtI0+htLQHLbPSn3zMrvZpqwMGGWijHmiC1ZdIqPdBjaGYmuB7HfwlGHtHPe/hK079wLKOVrpPRhI2GzHnbKX0YWPWKn9j8y7QzIHNI4E/GMJEq7NrOnrOzSU1VFTQUssBDmPY0An3FSGeAX1rC8jeU9eKxvM4yyg8pZUeUQct4yCRAoAU4KAkBXVapzT3OmkG6cyCMhwyCH+Lx9ziuMFDI8s3ZBzY9rh8RysJRUouL7w+BibUlsmsuoblZqmSKSegq5aWR8ZJY50by0lueOMjgvPX3O3y0xWXbFqWhgnknYaw1G+8AHMrWykcO4vI+JfDLzOS1W0aolZfRqbKNqdPNHFI9sVBWukc1pIYDTSNyT2DJAye0gdqrRWv0X4LtLr6vlt8r2UsFmq33FrZd0PhLN0Aj84da6I47wD2Lmte3hzXuC7YTiNo9xSAqKI+I3zIwV6T3mRICiBUYKIFASAogVECnBQqJcpwVGCnyhQ8pwVEXJb+ByJ9wdqhCYFxIaxrnuccNa0ZJPcFamgNk8tY2K5amcWRHxmUjeB/7ivX2M6BZRwQ6ivDA+rkG9TxEcIW9591WuOC6xpTTMlJ0qD5v+iNnHarXQWunbT0FLFBG0YAa3H9V2pJLrEpOTyzESSSSgEkkkgEmSK+F2n68ptOUbqOjc2a5yjDGA/i/8TlzUKE681CCy2VLJ8tt01HHUTRaeppA4RkSVBB7exqq/eUcs0tRPJUTyGSaVxfI89pKQK7/Z20bWkqce73OZbtxJlLKAFPlbZlkMFECo0QKAkygnOYz5ksoJT4h8xRFKA6XlJR0+1aGopYBE+stFJUVBBJ6yUsLS7jy4Nby4cFTiuPpcO39pFud/kVH9NU4vNrlYrTX5ZrPiJW90VrtTW7Wl7op2ymS52CqpYCwAgPaWSku48BuxO7+OFUKsPo8eufTfAa35tIlr28Oa9yF+wHybfMpAVzwO8m3zKUFekviUlBT5QApwUKGCiBUeU4KAkynBQApZQoRK+y2P6aOotWxvmZmioiJZc8nO7G/7r4p791pcewZWjdgtm+5eiIqiVgE9Y8yuPbjPD+i+bpe6dtbNx4vcjFssFrQ1oa0AAcgE6SS6CQSSjnljghfNM9rI2DLnOOAAqi1ntkip6l9Hp2mFSWHBqJPUZ9wdq2rWzrXUtWkslSyXBlJZon2m6ymkL/uiyLJ9SxpAC9aybXdRUkjRXxQ10Q9VjxXL6cuj90llNP8AYwaCQve1jS5xAA5kr5HTG0TTd7pt/wAMZSTNGXxTkNI/fzVcbWtostxqZLLYapzKNnizVEZwZD3A9y07fRdxWrbJxxjjnuCWWe/tL2pQ0PW2rTxE9XxbJUD1EX1lUs+Waed9RUSumnkO8+RxyXFRjA5cEYK7nZ2NK0hqwW/vficqWCRpRAqMJwVt4KiUFOCowU+VSkgKIFRAogUBJlRzO8m7zFLKind5J3mKq4lKF6V5ztDtp/yKk+mqgVudKk51/bD/AJHSfTVRrze8+onzfua74iVh9Hn1zqb4DW/NpFXisLo9+uZT/Aa35tIsbXt4c17kL3hPk2+ZSgqCE+Tb5lKCvSWUlaUQKiBRAqAlCSEFOqUPKfKAFOgJqSA1VbT0jec0zI/3nC1/ZaVtFaaSkYABFC1mB7gWV9nlMKzXdngIyDOHH4uK1m3kuq9JKnzwh+MmI6Y8AnQSndjcR2An+i6yCktvusJnVn3rUE7mMa0OrHMOCc8mqomAAYHABehrColq9YXepmzvvqnA57gvOC9FsLeNvQjCP75maDCLPFCEvMtwo5AJyRx707QAMDgEPFOCrkpIEQKAJKFJQUSiBRBygJAU+VGCiBQoaWUOUsoMh5UVQfIv96USiqD5F/vT8iq4lKH6U/5e2z9hUn01UitvpT/l7a/2FSfTVSLze8+onzfucD4iVhdHr1zKf4BW/NpFXqsHo+HG0uD4BW/NpFja9vDmvchekJ8k3zKQFQQnybfMpQV6SwSgogVECiBQEoKLKjBTgoXJICizwUYKIHggPs9i0Ql2kW7I9SHH+i1AOSzHsNI/tHoePNrvkWnAum9IX/qY8v7IOmcMtIPanSXwQZW2p2qS0a9uUL2kMmf18R7w7/8AF8y3JIA4k8gtKbXdEN1TafCKJrW3SmBMJ9mPYlZrrG1dvrH09RA6nrad2XRPHEEfKF33RV7G5opfyXEyT3Ht1ektU0lI2rmsdWIHAEPaAeB+NeO7ejOJY5Iz2hzCtFbLtotl1PaYKSpljpblGwMfTyduOGR2FfZ1VntdUcz0MEnnYFoT07VoTcK9PehrGQetZ7I/wlO1wPIOJ9xpWtRpuxDla6b+BTRWS0xeot9O3/sCdZafdTfmNYyVHBVSnEVFUv8AexlNI2SKQxzRSRPHNrxgrYDKSlYMMp4m+ZgVVdIm00LbHS3ZkTI6qOYR7zRjeaexZ2unVcVo03DGfyEylAU+UATgr72TPIYKIFRgogVShgp8oE+UAWVFUHyL/elGSopz5J/vT8iqBRXSl/Ly1/sKk+mqlVsdKLjru1/sOk+mqnXm959RPm/c4mJWD0ffXKg+AVvzaRV8rC6PfrmQfAK75tIsbXt4c17kLtgPk2+ZShQQHybfMpQV6SyZJAUQKAFOChSVpRAqHKMFASAogVGCnygPrNlFbHQ7QrTNK8MY6QsJPLiMBasDhjORjzrE5JBBBLSDkEHBBXvP1zq99G2iN8qBC0boxjex518XSeiZXlSM4ySwsMhraSpgj9XNG3zvChNyoAcGsgz78LG9TcLhUHM9wq5Se10h/wBlzF8p/wCfN6R31rSXRtd9T0/5KbYhqIJhmKaN/vXAr43aRs7tGr6Z0rmmluLR5OpjGDnud3hZltd1ultnbNQ3Kqp5GnILZCflVv6B20GNjKLVjBw4Nq4mnB98O9cNXQ1zaPa28s48OIKj1BZbvpa/vt9wa6CriO9HLGcbzexwKtnYjtMrJrjFprUMwkDxikqXcyfYuXgbfNT2LUNfbmWeRtRJC0ukmaMDB5NVcUU76WvpaiI7r46iNzSPfBfd2HxCzW3jiWPJjuNtJ1zWyV09uppnc3xNcfjC6V0BrDwBKq+ki7/hOkbnnVNVqKnOktUfgNqpd4ZdM5xHmC+homObyHMseJS4PFFlRg8U4K78ZB5TgoQU4KpkGCnygCdCjkqOoPkX+9PyIiVHUHyT/en5FkgUZ0ofy6tf7CpPpqp1bHSh/Lq1/sKk+mqnXm159RPmzhYlYXR69cyn+AV3zaRV6rD6PPrmwfAK75rIsbbtoc17guiA+Tb5lKCuanPkm+ZTAr0p8TDJK0ogowUQKhckgKcFACnyhckgKcOUeU+UKGShygLkg4IA0kdLDPVTCClhknmIyGRtycIJg6CUx1DHwSDm2Rpaf6oms4ATU5TM48uKIjgskCEtA5ADzLv07b5rtqK326Bhc+aoZwHcCCfkXJBHLUzCClifUTOOGsjGSStA7DdnMtixqG8sxcJWYihI/EtP+609IX0LSi5Se/uQLXpYhBTRQt5MYGj4gpUkl5y94GWd+kNcRUa1p6Jrsilgy4Z7TkLQs72xQvkccNaCSVkXWV0detXXO5uPiyzuaz3oPBfe6P0dau5+C9yo83PFOCowiC7iZEoKcFRgpwVQSAosqMFPlC5CKiqPxD/en5EeVFVn8Gl9475Fki9xR3SeOdb2o/5FSfTVUq1ek3+Wto/YNJ9NVUvNrz6ifN+5xCVidHb1z6f4BXfNZFXasXo6+uhT/AK75rIsLbtoc17hlv0p8i3zKcFctMfJN8ynBXpb4nGStKMFRAogUKSAp8qMFPlMFDynyo8p8oVDuKntFvrrxdIbXa4DUVkxw1g/NHee4KbT9muOoLxBabXCZKiY4zjgwdritTbMtBWzRtrbHE1s9c8ZnqXN8YnuHcF8zSOkYWcccZPghxOfZLs/pNG2jMu7PdJxvVE+OR9iPcC9/UGlLBfY3NuVsp53H88sG8PjXtp10id1VnUdVy+ZlKtr9iGlJ5C+nlq6bPY15ICgpNhmm45g+etrZmj83ewrZSWytK3iWNoweBprSGn9PRhtst0MTx/zC0F5+Ne8nSWlUqTqPWm8sCSSXPcKuCho5aqplbFDE0ue5xwAFik28IHxe23UYsGjJmxPAqaw9REM8ePM/Esys4NA/evpdpurpNX6kfVty2hgJjpmZ5j2Xxr5lpXe9FWjtqCUv8nvZSROhBThfUKEEQKjyiBQoQRZUeU+UBJlQ1p/A5j/AID8iIFQXF+7QTn/AAH5FkuJW9xSvSc/LSz/ALAo/keqpVr9J0Y1pZv/AC/R/I9VQvNbvt582cYlY3RzGdqNMP8AoK75rIq5VmdGeMy7WqOMfnUNd81lWNu8VY817hlp0x8k1TNK5qT8S3/72qcL0t8TiJQUYKhBRgqFJAeKWUGU4KZKGCpqKnnrK2CipYzLUVEgjiYO1xOP3LnV19GPScdXUVGraxge2JxgpA4epI5u/r/Ra15dRtaLqP8A6wWVsn0NS6PsTGvayW4zjeqZscc+xHuBfbpJLz2tWnWm5zeWzMSSSS4gJJMlkIB0lwXG8Wu3xOlrK+nha3mXPCrTWW26xWzfp7LFJc6kcA5vBg8+Vs0LStcPFOLYLQudfR22jkq62ojghjGXOe7AWbNrm0ifVszrZbDJBaI3nJzh1Qfsr5bV+sb/AKqqjJdKx/U5yynY4hjfrXhA8MLtejdDRt3tKu+XogTN4ADsRsKhBUjSvt4KiYFPlRgpwVSh5TgoMp8oA8pZQZTZQZJN5cd4d+BuYDzB+RdGV59xfvtk7g3CJ4JJ7iqelJGY9cWdp5/e/RfI9VKrY6VNypq7afFS07JWuttpo6KbfAAMjY94luDyw8c8dqqdea3DzVk/yyCVi9G64vt22nThjp2TmrqHUJa8kACdjoi7h2gPyB2kKul1WqoFJc6aqdv7sMzJDuHDsAg8Pd4Lii8NMGlIWmNpYRgtc4H95UgXdqxtPHqaudSkeDVDxVU+HA+TkAcOI4Hnjh2hec05XptOaqRU13nCSgowogUYKyKGCkmCdCjgq2Njm1S36Q0+6yXakndEyQviliGeB7CFUyYrXubanc09nU4DJpf+3jR+Pxddnu6n/wCVE/b3pUDxaWvd/wCks2fGlk96+ctBWng/MuszRE/SAsbQeotNbIewEYyvKrOkFK7hSacd53zBUbk96cedckdC2cf45/Y1mWrcNumq58iko6SlB5Zw7C+buW0nW9xz1t+mhB/NgJYvjwjatqnY21P/ABgvIZOmtqqqueZK+rqKt57Zn7yhAAGAAB3JgnW0ljci5HCIFAEQVKiQFG0qMFEChSUFECogUWULkkyllRlybeVBLvBNlRFybeVwUKaURxl3b2LjiYZ6iCn7Zp44/wCJwH+6Com62Xh6lvJdFpuFttNTJfLwyeS22uF1XUiFm88gYawAd5eWj3M5XBWmqcHN8EjBvJQO3G5vu21zU1TJTMp3R1z6Xq2OJAEOIQePeI8/Gvi0Uji+Rz3EkuJJJOSUK81by8lEkkkoDQez660V62Y2p8dVUS3SzOdRXBkjcBkLnuNOWnkW43m94I8xPssKprY3qel07qoQXWWOGy3RraS5yGnEr44d8O3mdocC0HI44yrmqaeW31RpJpGTAAOhqInB0dRGRlsjHDgWkY4hd00FeKrR2T4x9jjksMkaUTVEw5PNShfdZiGE6FLKhQkxSymQCSSSQCRBCnBQuQwiCAFECgCCJAnBVKGnCDKfKGRICnBQAp8oMkgKfeUeUiUGQ8pEoMoS7v4BXBQyVx1VRzjYfOU1TU5BZGfOVyE4TJGyTfxzOF4W12+O09szNr6iqjrdTvDmStcGsFHC7xmkczvSY7vUZz2L37bTR1Uk89ZI6C1UMRqblVBpcIIW8+XMnkB3kKhNp2qH6w1pX3oMkhpXuEVFA8/iKdnixs4cMho445uLj2rrun7xQp7CL3vjyIj5lJJJdPMhJJJIBK4djOsbPNZnaO1RWsoOpc+a0XOZx6uBxGXQSd0biMgj1Lic+q4U8kuahXnQqKpB4aI1k01Kyoo6k01TEYZgA4MPEOaeIc08i0jiCOBBUjJgefBVds92oG30NLpzVtK652OHydPNGQ2qoAXAksdjx2gb3k3cO4tVoUrLXdpHO0nfaTUkAD3hlOCyqaxpALnwuAeBxHHC7pY6Xo3KSk8S8P6ONxaJgQeRT5XE1+HFuS1w5hwII/ejErx3FfVyQ6cp8rlM5HMJdeO0JlFOrKYlc4nai65qZQJsogVz9c3vTiZnemUU6QU4K5xNH7JP18fslcoHQCnyoBNH7JP1sfskyUmynDlB10fs0uuj9kmS5OkFOHLm6+P2SXhDOw5TKGTqJCW8uN9SfzQoXSPceJTKGTtknY3tye4Lmmme8cTgdyiyO8BHSQVNdUtpaClnq6hxw2OGMuJUciNkZKmt9KKsmWWrpaGhY8NqK6qlEcEI5nLjzOATujicHguW53XSGnrdUV+o9QUdTUQl7IrNbqgSVMsrSAY5HNBEIyeLj3HAJGFS+0bX921pPDFPFT0NrpHPNFQUzcRwhx5k85H4wC93Hh2DgviX2mqVBatL5peiCWT1drWu4r4G6dsMfUWCkn65rnsb19TNuBjpHvBOW53t0DHA8clV2kkun1as6s3Oby2ZiSSSXGBJJJIBJJJIBKegraygqm1VDVT0tQzIbLDIWPbkYOCOIyCQoEkBadl23akipZabUdvtmqGuHk5bgxwmiwGgBr4y04wORzxJK9zS20/Q9c57NU2e7Wh5Ly2e0zCaMDA3W9VIQc5zk7+OXBUgktyjf3NFYhNkaTNAVOuNl+8TTX3UwHYJLUw/+6vbbW7NpImSt2r2qPfYHbkltqQ5uRnBwwjI5HBKzInye9ba05eL+S8kTURprwvZ1n12LL/Lqr7CJtXs47drNl/l1V9hZjye9LJ71fjt34ryQ1UadNXs2HLazZj/AKdVfYUT67Z6D4u1ayn/AE+q+wsz5Pelk96fHbvxXkhqo0uK/Z927VLJ/L6r7CMV2zz9a1lH+nVX2FmXJ70snvV+O3fivIaqNNit2d/rYsv8uqvsJxXbOu3azZf5dVfYWY8nvSye9Pjt34ryQ1Uad8N2c/rZsv8ALqr7CXh2zn9bFl/l1V9hZiye9LJ71Pjt54ryQ1UacNfs6/WvZf5dVfYTG4bPRy2rWX+X1X2FmTJ70snvV+O3fivJDVRpauvOzqjt81W/aXR1rowMU9FbZzLJkgeLvta3tzxcOAK86j1zsn3x4bfNVubnj1VsjB/rKs85KSxlpy8f8sfpDVRcly2vWClucbrFo7wqkY3xvuvWvkc92TxxHuhoxjhxOc8V81qba9ri90wo2XJloosNzS2qPwaMlpOHHd8YnxsZzxwF8AktKte16/aTbLgSSSS1SiSSSQCSSSQH/9k=" onclick="showTab('discover')" style="width:38px;height:38px;flex-shrink:0;cursor:pointer;mix-blend-mode:screen;" />
                <!-- Wordmark -->
                <div>
                    <div style="font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;font-size:18px;font-weight:800;color:white;letter-spacing:-0.3px;line-height:1.1;text-shadow:0 1px 4px rgba(0,0,0,0.15);">SlowDay</div>
                    <div style="font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;font-size:9px;font-weight:700;color:rgba(255,255,255,0.75);letter-spacing:2.5px;text-transform:uppercase;">DEALS</div>
                </div>
            </div>

            <!-- Right: savings badge + avatar / login -->
            <div class="user-menu" id="userMenu" style="display: none;">
                <div id="savingsBadge" onclick="showSavingsCelebration()" style="visibility:hidden;background:rgba(255,255,255,0.2);backdrop-filter:blur(8px);border-radius:16px;padding:4px 10px;margin-right:4px;border:1px solid rgba(255,255,255,0.3);cursor:pointer;transition:transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    <div style="font-size:9px;color:rgba(255,255,255,0.75);font-weight:600;text-transform:uppercase;letter-spacing:0.3px;">Saved</div>
                    <div style="font-size:14px;color:white;font-weight:800;line-height:1;margin-top:1px;" id="savingsAmount">$0</div>
                    <div style="font-size:8px;color:#fbbf24;font-weight:700;margin-top:1px;" id="savingsRank">Top 1%</div>
                </div>
                <div class="user-avatar" id="userAvatar" onclick="toggleUserDropdown()"></div>
            </div>
            <div class="user-menu" id="guestMenu">
                <button class="circle-login-btn" onclick="showAuthModal()" title="Login / Sign Up">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                </button>
            </div>
        </div>

        <!-- User Dropdown â€” outside header so it's never clipped -->
        <div class="user-dropdown" id="userDropdown" style="display:none;">
            <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;cursor:pointer;" onclick="openUserProfile()">
                <div style="width:42px;height:42px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:18px;" id="dropdownAvatar"></div>
                <div>
                    <div class="user-dropdown-name" id="userDropdownName"></div>
                    <div class="user-dropdown-email" id="userDropdownEmail"></div>
                </div>
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="#aaa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left:auto;"><polyline points="9 18 15 12 9 6"></polyline></svg>
            </div>
            <hr style="margin:4px 0 10px;border:none;border-top:1px solid #f0f0f0;">
            <button class="dropdown-btn" onclick="document.getElementById('userDropdown').style.display='none'; switchToProvider();">ðŸ’¼ My Provider Profile</button>
            <button onclick="document.getElementById('userDropdown').style.display='none'; showSlowDayPlusModal();" style="width:100%;padding:11px 14px;margin-top:8px;margin-bottom:8px;background:linear-gradient(135deg,#f59e0b,#d97706);color:white;border:none;border-radius:10px;font-size:14px;font-weight:700;cursor:pointer;text-align:left;display:flex;align-items:center;gap:8px;">âš¡ SlowDay+</button>
            <button class="dropdown-btn logout-red" onclick="logout()">ðŸšª Logout</button>
        </div>


        <div class="mode-toggle" id="modeToggle" style="display:none;">
            <button class="mode-btn active" onclick="switchMode('customer')">ðŸ›ï¸ Find Services</button>
            <button class="mode-btn" onclick="switchMode('provider')">ðŸ’¼ I'm a Provider</button>
        </div>

        <!-- Search Bar -->
        <div class="search-bar-wrap" id="searchBarWrap">
            <div class="search-bar">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <input type="text" id="searchInput" placeholder="Search services, location..." oninput="searchServices(this.value)">
                <input type="hidden" id="filterType" value="">
                <div class="custom-select-box filter-select-box" id="filterTypeBox" onclick="toggleCustomSelect('filterTypeBox')">
                    <span id="filterTypeLabel">All types</span>
                    <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="#667eea" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
                </div>
                <div class="custom-select-dropdown" id="filterTypeDropdown" style="display:none;min-width:160px;right:0;left:auto;">
                    <div class="custom-select-opt" onclick="pickFilterType('','All types')">All types</div>
                    <div class="custom-select-opt" onclick="pickFilterType('Haircut','Haircut')">Haircut</div>
                    <div class="custom-select-opt" onclick="pickFilterType('Barber','Barber')">Barber</div>
                    <div class="custom-select-opt" onclick="pickFilterType('Cleaning','Cleaning')">Cleaning</div>
                    <div class="custom-select-opt" onclick="pickFilterType('Massage','Massage')">Massage</div>
                    <div class="custom-select-opt" onclick="pickFilterType('Nails','Nails')">Nails</div>
                    <div class="custom-select-opt" onclick="pickFilterType('Spa','Spa')">Spa</div>
                    <div class="custom-select-opt" onclick="pickFilterType('Personal Training','Personal Training')">Personal Training</div>
                    <div class="custom-select-opt" onclick="pickFilterType('Dog Walking','Dog Walking')">Dog Walking</div>
                    <div class="custom-select-opt" onclick="pickFilterType('Tutoring','Tutoring')">Tutoring</div>
                    <div class="custom-select-opt" onclick="pickFilterType('Photography','Photography')">Photography</div>
                    <div class="custom-select-opt" onclick="pickFilterType('Car Detailing','Car Detailing')">Car Detailing</div>
                    <div class="custom-select-opt" onclick="pickFilterType('Laundry Service','Laundry Service')">Laundry Service</div>
                    <div class="custom-select-opt" onclick="pickFilterType('Other','Other')">Other</div>
                </div>
            </div>
        </div>

        <!-- Customer View -->
        <div id="customerView" class="view active">
            <div id="discoverTab" class="tab-content active">
                <div class="swipe-container">
                    <div class="card-stack" id="cardStack"></div>
                </div>
            </div>
            <div id="savedTab" class="tab-content" style="display:none;">
                <div class="saved-subtabs">
                    <button class="saved-stab active" id="stabSaved" onclick="switchSavedTab('saved')">â¤ï¸ Saved</button>
                    <button class="saved-stab" id="stabMyBookings" onclick="switchSavedTab('mybookings')">ðŸ“ My Bookings</button>
                </div>
                <div id="savedListWrap">
                    <div class="saved-list" id="savedList"></div>
                </div>
                <div id="myBookingsWrap" style="display:none;">
                    <div class="my-bookings-section" id="myBookingsList">
                        <div class="empty-state"><div class="empty-emoji">ðŸ“</div><h3>No bookings yet</h3><p>Book a service to see your status here</p></div>
                    </div>
                </div>
                
            </div>
        </div>

        <!-- Provider View -->
        <div id="providerView" class="view">
            <!-- Provider Sub-tabs -->
            <div class="provider-tabs">
                <button class="ptab-btn active" id="ptabProfile" onclick="switchProviderTab('profile')">ðŸ‘¤ Profile</button>
                <button class="ptab-btn" id="ptabBookings" onclick="switchProviderTab('bookings')">ðŸ“‹ Bookings <span class="badge" id="pendingBadge" style="display:none"></span></button>
                <button class="ptab-btn" id="ptabCalendar" onclick="switchProviderTab('calendar')">ðŸ“… Calendar</button>
                <button class="ptab-btn" id="ptabAnalytics" onclick="switchProviderTab('analytics')">ðŸ“Š Analytics</button>
            </div>

            <!-- PROFILE TAB -->
            <div id="ptabProfileContent">
                <form class="provider-form" onsubmit="submitProvider(event)">
                    <div class="form-group"><label>Your Name/Business Name</label><input type="text" id="providerName" required placeholder="e.g., Sarah's Hair Studio"></div>
                    <div class="form-group"><label>Service Type</label>
                        <select id="serviceType" required>
                            <option value="">Select a service type</option>
                            <option value="Haircut">Haircut</option><option value="Barber">Barber</option>
                            <option value="Cleaning">Cleaning Service</option><option value="Massage">Massage</option>
                            <option value="Nails">Nail Service</option><option value="Spa">Spa Treatment</option>
                            <option value="Personal Training">Personal Training</option><option value="Dog Walking">Dog Walking</option>
                            <option value="Tutoring">Tutoring</option><option value="Photography">Photography</option>
                            <option value="Car Detailing">Car Detailing</option><option value="Laundry Service">Laundry Service</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group"><label>Service Description</label><textarea id="serviceDesc" required placeholder="Describe what you offer..."></textarea></div>
                    <div class="form-group"><label>Location/Area</label><input type="text" id="location" required placeholder="e.g., Downtown Brooklyn"></div>
                    <div class="form-group"><label>Phone Number <span style="color:#888;font-weight:400;font-size:12px;">(for SMS notifications)</span></label><input type="text" id="providerContact" required placeholder="e.g., 6471234567"></div>
                    <div class="form-group"><label>Email Address <span style="color:#888;font-weight:400;font-size:12px;">(for email notifications)</span></label><input type="email" id="providerEmail" required placeholder="your@email.com"></div>

                    <!-- PRICING SECTION -->
                    <div class="form-group">
                        <label>Your Normal Price <span style="color:#888;font-weight:400;font-size:12px;">(regular rate, shown as crossed-out)</span></label>
                        <input type="number" id="normalPrice" placeholder="e.g. 80" step="0.01" min="0">
                    </div>
                    <div class="form-group"><label>Special Deal Pricing</label>
                        <div class="price-row">
                            <div><label style="font-size:12px;">Weekday Deal Price</label><input type="number" id="weekdayPrice" required placeholder="$" step="0.01"></div>
                            <div><label style="font-size:12px;">Weekend Deal Price</label><input type="number" id="weekendPrice" required placeholder="$" step="0.01"></div>
                        </div>
                    </div>

                    <!-- SLOTS SECTION -->
                    <div class="form-group">
                        <label>Deal Slots <span style="color:#888;font-weight:400;font-size:12px;">(leave blank for unlimited)</span></label>
                        <div class="price-row">
                            <div><label style="font-size:12px;">Weekday Slots</label><input type="number" id="weekdaySlots" placeholder="Unlimited" min="1" step="1"></div>
                            <div><label style="font-size:12px;">Weekend Slots</label><input type="number" id="weekendSlots" placeholder="Unlimited" min="1" step="1"></div>
                        </div>
                    </div>

                    <!-- DEAL TOGGLE -->
                    <div class="form-group">
                        <label>Deal Status</label>
                        <div style="display:flex;align-items:center;gap:12px;padding:14px;background:#f8f9fa;border-radius:12px;">
                            <div id="dealToggle" onclick="toggleDeal()" style="width:52px;height:28px;border-radius:14px;background:#22c55e;cursor:pointer;position:relative;transition:background 0.3s;flex-shrink:0;">
                                <div id="dealToggleKnob" style="position:absolute;top:3px;left:3px;width:22px;height:22px;border-radius:50%;background:white;transition:left 0.3s;left:27px;box-shadow:0 1px 4px rgba(0,0,0,0.2);"></div>
                            </div>
                            <div>
                                <div id="dealToggleLabel" style="font-weight:600;font-size:14px;color:#22c55e;">Deal is LIVE</div>
                                <div style="font-size:12px;color:#888;">Customers can book this deal</div>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="dealActive" value="true">

                    <!-- AVAILABILITY WINDOWS -->
                    <div class="form-group">
                        <label>Availability Windows <span style="color:#888;font-weight:400;font-size:12px;">(optional â€” restrict to specific days/times)</span></label>
                        <div id="availabilityList" style="display:flex;flex-direction:column;gap:10px;margin-bottom:10px;"></div>
                        <button type="button" onclick="addAvailabilityWindow()" style="width:100%;padding:10px;background:#f0f0ff;color:#667eea;border:2px dashed #667eea;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;">+ Add Time Window</button>
                    </div>

                    <div class="form-group"><label>Upload Photos of Your Work</label>
                        <div class="photo-upload" onclick="document.getElementById('photoInput').click()">
                            <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="#667eea" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin:0 auto 10px;"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                            <p style="color:#667eea;font-weight:600;">Click to upload photos</p>
                            <p style="font-size:12px;color:#999;margin-top:5px;">Up to 6 photos</p>
                            <input type="file" id="photoInput" accept="image/*" multiple onchange="previewPhotos(event)">
                        </div>
                        <div class="photo-preview" id="photoPreview"></div>
                    </div>
                    <button type="submit" class="submit-btn" id="providerSubmitBtn">Create My Profile</button>
                </form>
                <div id="myProfileView" style="display:none;padding:20px;">
                    <div id="myProfileCard"></div>
                    <div style="display:flex;gap:10px;margin-top:16px;">
                        <button onclick="editMyProfile()" style="flex:1;padding:14px;background:#667eea;color:white;border:none;border-radius:12px;font-size:15px;font-weight:600;cursor:pointer;">âœï¸ Edit</button>
                        <button onclick="deleteMyProfile()" style="flex:1;padding:14px;background:#fee2e2;color:#e53e3e;border:none;border-radius:12px;font-size:15px;font-weight:600;cursor:pointer;">ðŸ—‘ï¸ Delete</button>
                    </div>
                </div>
            </div>

            <!-- BOOKINGS TAB -->
            <div id="ptabBookingsContent" style="display:none;">
                <div style="padding:16px;">
                    <div style="display:flex;gap:8px;margin-bottom:16px;overflow-x:auto;padding-bottom:4px;">
                        <button class="filter-btn active" onclick="filterProviderBookings('all', this)">All</button>
                        <button class="filter-btn" onclick="filterProviderBookings('pending', this)">â³ Pending</button>
                        <button class="filter-btn" onclick="filterProviderBookings('confirmed', this)">âœ… Confirmed</button>
                        <button class="filter-btn" onclick="filterProviderBookings('rescheduled', this)">ðŸ”„ Rescheduled</button>
                        <button class="filter-btn" onclick="filterProviderBookings('rejected', this)">âŒ Rejected</button>
                    </div>
                    <div id="providerBookingsList"><div class="empty-state"><div class="empty-emoji">ðŸ“‹</div><h3>No bookings yet</h3><p>Bookings will appear here once customers book your service</p></div></div>
                </div>
            </div>

            <!-- CALENDAR TAB -->
            <div id="ptabCalendarContent" style="display:none;">
                <div style="padding:16px;">
                    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
                        <button onclick="changeCalMonth(-1)" style="width:36px;height:36px;border-radius:50%;border:1.5px solid #e0e0e0;background:white;font-size:18px;cursor:pointer;">â€¹</button>
                        <div id="calMonthLabel" style="font-size:17px;font-weight:700;color:#333;"></div>
                        <button onclick="changeCalMonth(1)" style="width:36px;height:36px;border-radius:50%;border:1.5px solid #e0e0e0;background:white;font-size:18px;cursor:pointer;">â€º</button>
                    </div>
                    <div style="display:grid;grid-template-columns:repeat(7,1fr);gap:2px;margin-bottom:4px;">
                        <div style="text-align:center;font-size:11px;font-weight:700;color:#aaa;padding:4px 0;">S</div>
                        <div style="text-align:center;font-size:11px;font-weight:700;color:#aaa;padding:4px 0;">M</div>
                        <div style="text-align:center;font-size:11px;font-weight:700;color:#aaa;padding:4px 0;">T</div>
                        <div style="text-align:center;font-size:11px;font-weight:700;color:#aaa;padding:4px 0;">W</div>
                        <div style="text-align:center;font-size:11px;font-weight:700;color:#aaa;padding:4px 0;">T</div>
                        <div style="text-align:center;font-size:11px;font-weight:700;color:#aaa;padding:4px 0;">F</div>
                        <div style="text-align:center;font-size:11px;font-weight:700;color:#aaa;padding:4px 0;">S</div>
                    </div>
                    <div id="calGrid" style="display:grid;grid-template-columns:repeat(7,1fr);gap:2px;margin-bottom:16px;"></div>
                    <div id="calDayBookings"></div>
                </div>
            </div>

            <!-- ANALYTICS TAB -->
            <div id="ptabAnalyticsContent" style="display:none;">
                <div style="padding:16px;" id="analyticsContent">
                    <div class="empty-state"><div class="empty-emoji">ðŸ“Š</div><h3>Loading analytics...</h3></div>
                </div>
            </div>
        </div>

        <!-- User Profile Modal -->
        <div class="modal" id="userProfileModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ðŸ‘¤ My Account</h2>
                    <button class="close-btn" onclick="document.getElementById('userProfileModal').classList.remove('active')">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
                <div class="modal-body" style="padding:20px;">
                    <div id="profileMsg" style="display:none;padding:10px 14px;border-radius:10px;margin-bottom:16px;font-size:14px;font-weight:600;"></div>

                    <!-- Change Name -->
                    <div style="margin-bottom:24px;">
                        <h3 style="font-size:14px;font-weight:700;color:#333;margin-bottom:10px;">âœï¸ Change Name</h3>
                        <input type="text" id="newName" placeholder="New name" style="width:100%;padding:12px;border:1.5px solid #e0e0e0;border-radius:10px;font-size:14px;margin-bottom:10px;">
                        <button onclick="updateName()" style="width:100%;padding:12px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;">Save Name</button>
                    </div>

                    <hr style="border:none;border-top:1px solid #f0f0f0;margin-bottom:24px;">

                    <!-- SlowDay+ Status -->
                    <div id="slowdayPlusAccountSection" style="margin-bottom:24px;"></div>

                    <!-- Change Password -->
                    <div style="margin-bottom:24px;">
                        <h3 style="font-size:14px;font-weight:700;color:#333;margin-bottom:10px;">ðŸ”’ Change Password</h3>
                        <input type="password" id="currentPassword" placeholder="Current password" style="width:100%;padding:12px;border:1.5px solid #e0e0e0;border-radius:10px;font-size:14px;margin-bottom:8px;">
                        <input type="password" id="newPassword" placeholder="New password (min 6 chars)" style="width:100%;padding:12px;border:1.5px solid #e0e0e0;border-radius:10px;font-size:14px;margin-bottom:10px;">
                        <button onclick="updatePassword()" style="width:100%;padding:12px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;">Change Password</button>
                    </div>

                    <hr style="border:none;border-top:1px solid #f0f0f0;margin-bottom:24px;">

                    <!-- Delete Account -->
                    <div>
                        <h3 style="font-size:14px;font-weight:700;color:#e53e3e;margin-bottom:6px;">âš ï¸ Delete Account</h3>
                        <p style="font-size:13px;color:#888;margin-bottom:10px;">This permanently deletes your account and all your data. Cannot be undone.</p>
                        <button onclick="deleteAccount()" style="width:100%;padding:12px;background:#fee2e2;color:#e53e3e;border:1.5px solid #fca5a5;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;">Delete My Account</button>
                    </div>

                    <hr style="border:none;border-top:1px solid #f0f0f0;margin:24px 0;">

                    <!-- Support Tickets -->
                    <div>
                        <h3 style="margin:0 0 12px;font-size:15px;color:#1a1a2e;">ðŸŽ« Support</h3>
                        <div id="accountOpenTickets" style="margin-bottom:12px;"></div>
                        <input type="text" id="ticketSubject" placeholder="Subject" style="width:100%;padding:11px 14px;border:1.5px solid #e0e0e0;border-radius:10px;font-size:14px;box-sizing:border-box;margin-bottom:8px;">
                        <textarea id="ticketMessage" placeholder="Describe your issue..." style="width:100%;padding:11px 14px;border:1.5px solid #e0e0e0;border-radius:10px;font-size:14px;box-sizing:border-box;height:90px;resize:none;font-family:inherit;margin-bottom:8px;"></textarea>
                        <button onclick="submitSupportTicket()" style="width:100%;padding:12px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;border-radius:10px;font-size:14px;font-weight:700;cursor:pointer;">Submit Ticket</button>
                    </div>

                    <hr style="border:none;border-top:1px solid #f0f0f0;margin:24px 0;">

                    <!-- Legal Links -->
                    <div style="display:flex;justify-content:center;gap:20px;padding:10px 0;">
                        <a href="#" onclick="showTerms();return false;" style="font-size:13px;color:#667eea;text-decoration:none;font-weight:600;">Terms of Use</a>
                        <span style="color:#ddd;">|</span>
                        <a href="#" onclick="showPrivacy();return false;" style="font-size:13px;color:#667eea;text-decoration:none;font-weight:600;">Privacy Policy</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reschedule Modal -->
        <div class="modal" id="rescheduleModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ðŸ”„ Reschedule Booking</h2>
                    <button class="close-btn" onclick="document.getElementById('rescheduleModal').classList.remove('active')">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
                <div class="modal-body" style="padding:20px;">
                    <p style="color:#666;margin-bottom:16px;">Select a new date and time for this booking:</p>
                    <div class="custom-dt-picker" style="margin-bottom:16px;">
                        <input type="date" id="rescheduleDate" class="dt-date-input">
                        <div class="dt-time-row">
                            <select id="rescheduleHour" class="dt-select">
                                <option value="07">7 AM</option><option value="08">8 AM</option>
                                <option value="09">9 AM</option><option value="10">10 AM</option>
                                <option value="11">11 AM</option><option value="12">12 PM</option>
                                <option value="13">1 PM</option><option value="14">2 PM</option>
                                <option value="15">3 PM</option><option value="16">4 PM</option>
                                <option value="17">5 PM</option><option value="18">6 PM</option>
                                <option value="19">7 PM</option><option value="20">8 PM</option>
                                <option value="21">9 PM</option>
                            </select>
                            <select id="rescheduleMinute" class="dt-select">
                                <option value="00">:00</option>
                                <option value="15">:15</option>
                                <option value="30">:30</option>
                                <option value="45">:45</option>
                            </select>
                        </div>
                    </div>
                    <button onclick="confirmReschedule()" style="width:100%;padding:14px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;border-radius:12px;font-size:15px;font-weight:600;cursor:pointer;">Confirm New Time</button>
                </div>
            </div>
        </div>

        <!-- Bottom Nav -->
        <div class="bottom-nav">
            <button class="nav-btn active" id="navDiscover" onclick="showTab('discover')">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <span>Discover</span>
            </button>
            <button class="nav-btn" id="navSaved" onclick="showTab('saved')">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                <span>Saved</span>
            </button>
            <button class="nav-btn" id="navProvider" onclick="showTab('provider')">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>
                <span>My Profile</span>
            </button>
        </div>

        <!-- Detail Modal -->
        <div class="modal" id="detailModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Service Details</h2>
                    <button class="close-btn" onclick="closeModal()">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- Details will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Auth Modal -->
        <div class="modal" id="authModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="authTitle">Welcome to SlowDay Deals</h2>
                    <button class="close-btn" onclick="closeAuthModal()">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Login Form -->
                    <form id="loginForm" class="auth-form" onsubmit="login(event)">
                        <div class="form-group">
                            <label>Email or Phone Number</label>
                            <input type="text" id="loginEmail" required placeholder="email@example.com or +1234567890">
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="loginPassword" required>
                        </div>
                        <div style="text-align:right;margin-top:-8px;margin-bottom:12px;">
                            <a href="#" onclick="showForgotPassword(); return false;" style="color:#667eea;font-size:13px;font-weight:500;">Forgot password?</a>
                        </div>
                        <button type="submit" class="submit-btn">Log In</button>
                        <p style="text-align: center; margin-top: 15px; color: #666;">
                            Don't have an account? 
                            <a href="#" onclick="showSignup(); return false;" style="color: #667eea; font-weight: 600;">Sign Up</a>
                        </p>
                    </form>

                    <!-- Forgot Password Form -->
                    <form id="forgotForm" class="auth-form" style="display:none;" onsubmit="sendResetEmail(event)">
                        <p style="color:#666;font-size:14px;margin-bottom:20px;line-height:1.5;">Enter your email address and we'll send you a link to reset your password.</p>
                        <div class="form-group">
                            <label>Email or Phone Number</label>
                            <input type="text" id="forgotEmail" required placeholder="email@example.com or +1234567890">
                        </div>
                        <div id="forgotSuccess" style="display:none;background:#f0fdf4;border:1px solid #86efac;border-radius:10px;padding:12px;margin-bottom:16px;color:#166534;font-size:14px;text-align:center;">
                            âœ… Reset link sent! Check your inbox.
                        </div>
                        <button type="submit" class="submit-btn" id="forgotBtn">Send Reset Link</button>
                        <p style="text-align:center;margin-top:15px;color:#666;">
                            Remember your password?
                            <a href="#" onclick="showLogin(); return false;" style="color:#667eea;font-weight:600;">Log In</a>
                        </p>
                    </form>

                    <!-- Reset Password Form (shown when token is in URL) -->
                    <form id="resetForm" class="auth-form" style="display:none;" onsubmit="resetPassword(event)">
                        <p style="color:#666;font-size:14px;margin-bottom:20px;">Enter your new password below.</p>
                        <div class="form-group">
                            <label>New Password</label>
                            <input type="password" id="resetPassword" required minlength="6" placeholder="At least 6 characters">
                        </div>
                        <div class="form-group">
                            <label>Confirm New Password</label>
                            <input type="password" id="resetPasswordConfirm" required minlength="6" placeholder="Repeat new password">
                        </div>
                        <div id="resetError" style="display:none;background:#fef2f2;border:1px solid #fca5a5;border-radius:10px;padding:12px;margin-bottom:16px;color:#991b1b;font-size:14px;text-align:center;"></div>
                        <button type="submit" class="submit-btn">Reset Password</button>
                    </form>

                    <!-- Signup Form -->
                    <form id="signupForm" class="auth-form" style="display: none;" onsubmit="signup(event)">
                        <div class="form-group">
                            <label>Account Type</label>
                            <input type="hidden" id="signupAccountType" value="customer" required>
                            <div class="custom-select-box" id="accountTypeBox" onclick="toggleCustomSelect('accountTypeBox')">
                                <span id="accountTypeLabel">ðŸ›ï¸ Customer â€” I want to book services</span>
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="#667eea" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
                            </div>
                            <div class="custom-select-dropdown" id="accountTypeDropdown" style="display:none;">
                                <div class="custom-select-opt" onclick="pickAccountType('customer','ðŸ›ï¸ Customer â€” I want to book services')">ðŸ›ï¸ Customer â€” I want to book services</div>
                                <div class="custom-select-opt" onclick="pickAccountType('provider','ðŸ”§ Provider â€” I offer services')">ðŸ”§ Provider â€” I offer services</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="signupName" required>
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="signupEmail" required>
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="signupPassword" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" id="signupPhone" required>
                        </div>
                        <button type="submit" class="submit-btn">Create Account</button>
                        <p style="text-align: center; margin-top: 15px; color: #666;">
                            Already have an account? 
                            <a href="#" onclick="showLogin(); return false;" style="color: #667eea; font-weight: 600;">Log In</a>
                        </p>
                        <div style="text-align:center;margin-top:20px;padding-top:16px;border-top:1px solid #f0f0f0;">
                            <p style="font-size:11px;color:#999;line-height:1.6;">
                                By creating an account, you agree to our<br>
                                <a href="#" onclick="closeAuthModal();showTerms();return false;" style="color:#667eea;font-weight:600;text-decoration:none;">Terms of Use</a>
                                <span style="color:#ddd;margin:0 4px;">â€¢</span>
                                <a href="#" onclick="closeAuthModal();showPrivacy();return false;" style="color:#667eea;font-weight:600;text-decoration:none;">Privacy Policy</a>
                            </p>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Booking Modal -->
        <div class="modal" id="bookingModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Book This Service</h2>
                    <button class="close-btn" onclick="closeBookingModal()">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="bookingSuccess" class="success-message" style="display: none;">
                        âœ… Booking request sent! The provider will contact you soon.
                    </div>
                    <form class="booking-form" onsubmit="submitBooking(event)">
                        <div class="form-group">
                            <label>Your Name</label>
                            <input type="text" id="customerName" required>
                        </div>
                        <div class="form-group">
                            <label>Contact (Phone or Email)</label>
                            <input type="text" id="customerContact" required>
                        </div>
                        <div class="form-group">
                            <label>Preferred Date & Time</label>
                            <!-- Standard picker (shown when no availability windows) -->
                            <div id="standardPicker" class="custom-dt-picker" style="overflow:hidden;max-width:100%;">
                                <input type="hidden" id="preferredDate">
                                <div id="customDatePicker" class="custom-date-picker">
                                    <div class="cdp-header">
                                        <button type="button" class="cdp-nav" onclick="cdpChangeMonth(-1)">&#8249;</button>
                                        <span id="cdpMonthLabel" class="cdp-month-label"></span>
                                        <button type="button" class="cdp-nav" onclick="cdpChangeMonth(1)">&#8250;</button>
                                    </div>
                                    <div class="cdp-weekdays">
                                        <span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span>
                                    </div>
                                    <div class="cdp-grid" id="cdpGrid"></div>
                                    <div id="cdpHint" class="cdp-hint"></div>
                                </div>
                                <div class="dt-time-row">
                                    <select id="preferredHour" class="dt-select">
                                        <option value="07">7 AM</option><option value="08">8 AM</option>
                                        <option value="09">9 AM</option><option value="10">10 AM</option>
                                        <option value="11">11 AM</option><option value="12">12 PM</option>
                                        <option value="13">1 PM</option><option value="14">2 PM</option>
                                        <option value="15">3 PM</option><option value="16">4 PM</option>
                                        <option value="17">5 PM</option><option value="18">6 PM</option>
                                        <option value="19">7 PM</option><option value="20">8 PM</option>
                                        <option value="21">9 PM</option>
                                    </select>
                                    <select id="preferredMinute" class="dt-select">
                                        <option value="00">:00</option>
                                        <option value="15">:15</option>
                                        <option value="30">:30</option>
                                        <option value="45">:45</option>
                                    </select>
                                </div>
                            </div>
                            <!-- Slot picker (shown when provider has set availability windows) -->
                            <div id="slotPicker" style="display:none;">
                                <p style="font-size:13px;color:#666;margin-bottom:10px;">Select an available time slot:</p>
                                <div id="slotDayTabs" style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;"></div>
                                <div id="slotTimeGrid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;"></div>
                                <input type="hidden" id="selectedSlotTime">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Additional Notes (Optional)</label>
                            <textarea id="bookingNotes" placeholder="Any special requests or questions..."></textarea>
                        </div>
                        <button type="submit" class="book-now-btn">Confirm Booking</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // STATE
        // ============================================
        let currentUser = null;
        let services = [];
        let currentCardIndex = 0;
        let savedServices = [];
        let currentBookingService = null;
        let myBookings = [];

        // Google Places Autocomplete
        window.initPlaces = function() {
            const locationInput = document.getElementById('location');
            if (locationInput && window.google && google.maps && google.maps.places) {
                try {
                    const autocomplete = new google.maps.places.Autocomplete(locationInput, {
                        types: ['geocode'],
                        componentRestrictions: {country: ['ca', 'us']}
                    });
                    autocomplete.addListener('place_changed', () => {
                        const place = autocomplete.getPlace();
                        if (place.formatted_address) {
                            locationInput.value = place.formatted_address;
                        }
                    });
                } catch (err) {
                    console.log('Google Places autocomplete not available, manual entry enabled');
                    // Silently fail - user can still type address manually
                }
            }
        };

        // ============================================
        // INIT
        // ============================================
        window.onload = async function() {
            checkResetToken();
            // Check for deep-link tab param from email/SMS
            const urlParams = new URLSearchParams(window.location.search);
            const deepTab = urlParams.get('tab');
            const subResult = urlParams.get('subscription');
            if (subResult === 'success') {
                sessionStorage.setItem('showPlusSuccess', '1');
                window.history.replaceState({}, '', window.location.pathname);
            }
            if (deepTab) {
                sessionStorage.setItem('deepLinkTab', deepTab);
                // Clean URL
                window.history.replaceState({}, '', window.location.pathname);
            }
            showWakingUp();
            await wakeUpServer();
            const token = API.getToken();
            if (token) {
                try {
                    const response = await API.getCurrentUser();
                    currentUser = response.user;
                    await showAuthenticatedView();
                    // Handle deep link after login
                    handleDeepLink();
                } catch (error) {
                    API.removeToken();
                    await loadPublicServices();
                    // If deep link present but not logged in, prompt login
                    if (deepTab || sessionStorage.getItem('deepLinkTab')) {
                        showToast('Please log in to view your bookings', false);
                        showAuthModal();
                    }
                }
            } else {
                await loadPublicServices();
                if (deepTab || sessionStorage.getItem('deepLinkTab')) {
                    showToast('Please log in to view your bookings', false);
                    showAuthModal();
                }
            }
        };

        function showWakingUp() {
            const stack = document.getElementById('cardStack');
            if (stack) {
                stack.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-emoji">âš¡</div>
                        <h3>Warming up...</h3>
                        <p>Our free server is waking up.<br>Ready in about 30 seconds!</p>
                        <div style="margin-top:20px;width:200px;height:6px;background:#eee;border-radius:3px;overflow:hidden;">
                            <div id="loadingBar" style="width:0%;height:100%;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:3px;transition:width 0.5s;"></div>
                        </div>
                        <div class="empty-dots" style="margin-top:16px;">
                            <span></span><span></span><span></span>
                        </div>
                    </div>`;
                let pct = 0;
                const interval = setInterval(() => {
                    pct = Math.min(pct + 2, 90);
                    const bar = document.getElementById('loadingBar');
                    if (bar) bar.style.width = pct + '%';
                    else clearInterval(interval);
                }, 600);
            }
        }

        async function wakeUpServer() {
            for (let attempt = 1; attempt <= 10; attempt++) {
                try {
                    const res = await fetch(`${API_CONFIG.BASE_URL.replace('/api','')}/api/health`, { signal: AbortSignal.timeout(8000) });
                    if (res.ok) {
                        const bar = document.getElementById('loadingBar');
                        if (bar) bar.style.width = '100%';
                        return true;
                    }
                } catch (e) { /* still waking */ }
                await new Promise(r => setTimeout(r, 3000));
            }
            return false;
        }

        async function loadPublicServices() {
            try {
                const response = await API.getServices();
                allServices = response.services || [];
                
                // Filter out provider's own service if they're a provider
                if (myService && myService._id) {
                    services = allServices.filter(s => (s._id || s.id) !== myService._id);
                } else {
                    services = [...allServices];
                }
            } catch (error) {
                allServices = [];
                services = [];
            }
            renderCards();
        }

        // ============================================
        // AUTH MODAL
        // ============================================
        function showAuthModal() {
            document.getElementById('authModal').classList.add('active');
            showLogin();
        }

        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('active');
        }

        function showLogin() {
            document.getElementById('authTitle').textContent = 'Welcome Back!';
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('signupForm').style.display = 'none';
            document.getElementById('forgotForm').style.display = 'none';
            document.getElementById('resetForm').style.display = 'none';
        }

        function showSignup() {
            document.getElementById('authTitle').textContent = 'Create Your Account';
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('signupForm').style.display = 'block';
            document.getElementById('forgotForm').style.display = 'none';
            document.getElementById('resetForm').style.display = 'none';
        }

        function showForgotPassword() {
            document.getElementById('authTitle').textContent = 'Reset Your Password';
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('signupForm').style.display = 'none';
            document.getElementById('forgotForm').style.display = 'block';
            document.getElementById('resetForm').style.display = 'none';
            document.getElementById('forgotSuccess').style.display = 'none';
        }

        async function sendResetEmail(e) {
            e.preventDefault();
            const emailOrPhone = document.getElementById('forgotEmail').value.trim();
            const btn = document.getElementById('forgotBtn');
            btn.disabled = true;
            btn.textContent = 'Sending...';
            try {
                await API.forgotPassword(emailOrPhone);
                document.getElementById('forgotSuccess').style.display = 'block';
                btn.textContent = 'Resend Link';
            } catch (err) {
                // Always show success to prevent email enumeration
                document.getElementById('forgotSuccess').style.display = 'block';
                btn.textContent = 'Resend Link';
            }
            btn.disabled = false;
        }

        async function resetPassword(e) {
            e.preventDefault();
            const password = document.getElementById('resetPassword').value;
            const confirm = document.getElementById('resetPasswordConfirm').value;
            const errorEl = document.getElementById('resetError');
            if (password !== confirm) {
                errorEl.textContent = 'Passwords do not match.';
                errorEl.style.display = 'block';
                return;
            }
            // Read token from sessionStorage (set by checkResetToken, works on Safari)
            const token = sessionStorage.getItem('pendingResetToken')
                || new URLSearchParams(window.location.search).get('resetToken');
            if (!token) {
                errorEl.textContent = 'Invalid or expired reset link. Please request a new one.';
                errorEl.style.display = 'block';
                return;
            }
            try {
                await API.resetPassword(token, password);
                showToast('âœ… Password reset successfully! Please log in with your new password.', true);
                // Clear token from URL
                sessionStorage.removeItem('pendingResetToken');
                window.history.replaceState({}, '', window.location.pathname);
                showLogin();
            } catch (err) {
                errorEl.textContent = err.message || 'Reset failed. Link may have expired. Please request a new one.';
                errorEl.style.display = 'block';
            }
        }

        // Check for reset token in URL on page load
        function checkResetToken() {
            // Robust token extraction - handles Safari URL quirks and Cloudflare rewrites
            let token = null;
            try {
                token = new URLSearchParams(window.location.search).get('resetToken');
            } catch(e) {}
            // Fallback: manual parse
            if (!token) {
                const match = window.location.search.match(/[?&]resetToken=([^&]+)/);
                if (match) token = decodeURIComponent(match[1]);
            }
            // Fallback: check hash (some email clients rewrite ? to #)
            if (!token) {
                const hashMatch = window.location.hash.match(/resetToken=([^&]+)/);
                if (hashMatch) token = decodeURIComponent(hashMatch[1]);
            }
            if (token) {
                // Store in sessionStorage so it survives modal open
                sessionStorage.setItem('pendingResetToken', token);
                // Clean URL immediately (Safari sometimes re-reads it)
                window.history.replaceState({}, '', window.location.pathname);
                showAuthModal();
                document.getElementById('authTitle').textContent = 'Set New Password';
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('signupForm').style.display = 'none';
                document.getElementById('forgotForm').style.display = 'none';
                document.getElementById('resetForm').style.display = 'block';
            }
        }

        async function login(e) {
            e.preventDefault();
            const emailOrPhone = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            try {
                const response = await API.login({ emailOrPhone, password });
                if (response.success) {
                    API.setToken(response.token);
                    currentUser = response.user;
                    await showAuthenticatedView();
                    closeAuthModal();
                    e.target.reset();
                    handleDeepLink();
                }
            } catch (error) {
                if (error.message === 'Failed to fetch') {
                    showToast('â³ Server is waking up (free tier). Please wait 30 seconds and try again!', true);
                } else {
                    showToast(error.message || 'Login failed. Please check your credentials.', true);
                }
            }
        }

        async function signup(e) {
            e.preventDefault();
            const userData = {
                name: document.getElementById('signupName').value,
                email: document.getElementById('signupEmail').value,
                password: document.getElementById('signupPassword').value,
                phone: document.getElementById('signupPhone').value,
                accountType: document.getElementById('signupAccountType').value
            };
            try {
                const response = await API.signup(userData);
                if (response.success) {
                    API.setToken(response.token);
                    currentUser = response.user;
                    showAuthenticatedView();
                    closeAuthModal();
                    e.target.reset();
                    showToast(`ðŸŽ‰ Welcome to SlowDay Deals, ${currentUser.name}!`, false);
                }
            } catch (error) {
                if (error.message === 'Failed to fetch') {
                    showToast('â³ Server is waking up (free tier). Please wait 30 seconds and try again!', true);
                } else {
                    showToast(error.message || 'Signup failed. Please try again.', true);
                }
            }
        }

        function logout() {
            showConfirmModal('Log out of SlowDay?', 'Log Out', function() {
                currentUser = null;
                API.removeToken();
                location.reload();
            });
        }

        function cancelMyBookingConfirm(id) {
            showConfirmModal('Cancel this booking?', 'Cancel Booking', function() {
                API.updateBookingStatus(id, 'cancelled')
                    .then(() => loadMyBookings())
                    .catch(() => showToast('Error cancelling booking', true));
            });
        }

        function showConfirmModal(message, confirmLabel, onConfirm) {
            const old = document.getElementById('confirmModal');
            if (old) old.remove();
            const overlay = document.createElement('div');
            overlay.id = 'confirmModal';
            overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:99999;display:flex;align-items:center;justify-content:center;padding:20px;';
            overlay.innerHTML = `<div style="background:white;border-radius:20px;padding:28px 24px;width:100%;max-width:320px;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,0.3);">
                <p style="font-size:17px;font-weight:600;color:#1a1a2e;margin:0 0 24px;">${message}</p>
                <div style="display:flex;gap:10px;">
                    <button onclick="document.getElementById('confirmModal').remove()" style="flex:1;padding:13px;border:1.5px solid #e0e0e0;border-radius:12px;background:white;font-size:15px;font-weight:600;color:#555;cursor:pointer;">Cancel</button>
                    <button id="confirmModalOk" style="flex:1;padding:13px;border:none;border-radius:12px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;font-size:15px;font-weight:600;cursor:pointer;">${confirmLabel}</button>
                </div>
            </div>`;
            document.querySelector('.app-container').appendChild(overlay);
            document.getElementById('confirmModalOk').onclick = function() {
                overlay.remove();
                onConfirm();
            };
        }

        async function showAuthenticatedView() {
            document.getElementById('userMenu').style.display = 'flex';
            document.getElementById('guestMenu').style.display = 'none';
            const firstLetter = currentUser.name.charAt(0).toUpperCase();
            document.getElementById('userAvatar').textContent = firstLetter;
            document.getElementById('dropdownAvatar').textContent = firstLetter;
            document.getElementById('userDropdownName').textContent = currentUser.name;
            document.getElementById('userDropdownEmail').textContent = currentUser.email;
            await loadSavedServices();
            await loadPublicServices();
            renderSavedList();
            await loadMyProfile();
            document.getElementById('savingsBadge').style.visibility = 'visible';
            await updateSavingsTracker();
            loadSubscriptionStatus();
            // Start real-time polling
            startRealtimePolling();
        }

        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        document.addEventListener('click', function(e) {
            const avatar = document.getElementById('userAvatar');
            const dropdown = document.getElementById('userDropdown');
            if (dropdown && avatar && !avatar.contains(e.target) && !dropdown.contains(e.target)) {
                dropdown.style.display = 'none';
            }
        });

        function switchToProvider() {
            const dd = document.getElementById('userDropdown');
            if (dd) dd.style.display = 'none';
            showTab('provider');
        }

        function handleProviderDropdown() {
            if (currentUser && currentUser.accountType === 'provider') {
                showTab('provider');
            } else {
                showTab('provider'); // takes customer to provider form
            }
        }

        function loadCustomerBookingsTab() {
            const list = document.getElementById('bookingsList');
            if (!list) return;
            list.innerHTML = '<div class="empty-state"><div class="empty-emoji">â³</div><h3>Loading...</h3></div>';
            API.getCustomerBookings().then(res => {
                const bookings = (res.bookings || []).sort((a,b) => new Date(b.preferredTime) - new Date(a.preferredTime));
                if (!bookings.length) {
                    list.innerHTML = '<div class="empty-state"><div class="empty-emoji">ðŸ“…</div><h3>No bookings yet</h3><p>Book a service to see your bookings here</p></div>';
                    return;
                }
                list.innerHTML = bookings.map(b => {
                    const svc = b.service || {};
                    const date = new Date(b.preferredTime).toLocaleString('en-US', { weekday:'short', month:'short', day:'numeric', hour:'2-digit', minute:'2-digit' });
                    const canCancel = ['pending','confirmed','rescheduled'].includes(b.status);
                    const cancelBtn = canCancel ? '<button class="action-btn btn-cancel" style="margin-top:10px;" onclick="cancelMyBooking('' + b._id + '')">Cancel Booking</button>' : '';
                    return '<div class="booking-card">' +
                        '<div class="booking-card-header"><div>' +
                        '<div class="booking-card-title">' + (svc.serviceType || 'Service') + '</div>' +
                        '<div class="booking-card-sub">by ' + (svc.providerName || '') + '</div>' +
                        '</div><span class="status-pill status-' + b.status + '">' + b.status + '</span></div>' +
                        '<div class="booking-meta">ðŸ“… <span>Date:</span> ' + date + '</div>' +
                        '<div class="booking-meta">ðŸ’° <span>Price:</span> $' + b.price + '</div>' +
                        (b.notes ? '<div class="booking-meta">ðŸ“ <span>Notes:</span> ' + b.notes + '</div>' : '') +
                        cancelBtn + '</div>';
                }).join('');
            }).catch(() => {
                list.innerHTML = '<div class="empty-state"><div class="empty-emoji">âŒ</div><h3>Error loading bookings</h3></div>';
            });
        }

        >